{% extends 'base.html.twig' %}

{% block title %}Mascotas Solicitadas{% endblock %}

{% block body %}
    
    <div style="background-color: #846355; min-height: 85vh; padding: 40px 0;">
        <div class="container">
            
            {# CONTENEDOR BLANCO #}
            <div class="bg-white shadow-lg" style="border-radius: 12px; padding: 40px; min-height: 80vh;">
                
                <h2 class="text-center mb-5" style="color: #000; font-weight: bold;">Mascotas Solicitadas</h2>

                {# FILTROS #}
                <div class="mb-4">
                    <button class="btn btn-sm text-white me-2" 
                            style="background-color: #0F5D3C;"
                            data-bs-toggle="modal" 
                            data-bs-target="#modalSolicitudesFiltro">
                        Filtros
                    </button>
                    {# Dropdown Ordenar Solicitudes #}
                    <select class="form-select d-inline-block w-auto form-select-sm" 
                            onchange="actualizarOrdenSolicitudes(this.value)">
                        <option selected>Ordenar por...</option>
                        <option value="reciente" {{ filtros.orden == 'reciente' ? 'selected' : '' }}>Más recientes</option>
                        <option value="antigua" {{ filtros.orden == 'antigua' ? 'selected' : '' }}>Más antiguas</option>
                        <option value="mas_solicitudes" {{ filtros.orden == 'mas_solicitudes' ? 'selected' : '' }}>Más solicitudes</option>
                        <option value="menos_solicitudes" {{ filtros.orden == 'menos_solicitudes' ? 'selected' : '' }}>Menos solicitudes</option>
                    </select>

                    {# SCRIPT AL FINAL DEL ARCHIVO #}
                    <script>
                        function actualizarOrdenSolicitudes(valor) {
                            const url = new URL(window.location.href);
                            url.searchParams.set('orden', valor);
                            window.location.href = url.toString();
                        }
                    </script>
                </div>

                {# LISTA DE TARJETAS #}
                <div class="row">
                    <div class="col-12">
                        
                        {% for mascota in mascotas %}
                            <div class="card mb-3 shadow-sm" style="border-radius: 15px; border: 2px solid #e0e0e0; overflow: hidden;">
                                <div class="row g-0 align-items-center">
                                    
                                    {# Foto (Izquierda) #}
                                    <div class="col-md-3 p-2">
                                        <div style="aspect-ratio: 4/3; overflow: hidden; border-radius: 10px;">
                                        <img src="{{ asset('uploads/mascotas/' ~ mascota.imagen) }}" 
                                            alt="{{ mascota.nombre }}" 
                                            style="width: 100%; height: 100%; object-fit: cover;">
                                        </div>
                                    </div>
                                    
                                    {# Datos (Centro/Derecha) #}
                                    <div class="col-md-9">
                                        <div class="card-body">
                                            <h3 class="fw-bold mb-1">{{ mascota.nombre }}</h3>
                                            <p class="text-muted small mb-3">
                                                N° de solicitudes: <strong>{{ mascota.solicitudes|length }}</strong>
                                            </p>
                                            
                                            {# Botón Ver Solicitudes #}
                                            <a href="{{ path('app_admin_ver_solicitudes', {id: mascota.id}) }}" 
                                                class="btn btn-sm" 
                                                style="background-color: #C6B6A8; color: #333; font-weight: bold;">
                                                Ver Solicitudes
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <p class="text-center text-muted mt-5">No hay solicitudes pendientes en este momento.</p>
                        {% endfor %}

                    </div>
                </div>

                {# PAGINACIÓN #}
                <div class="d-flex justify-content-center mt-5">
                    {{ knp_pagination_render(mascotas) }}
                </div>

            </div>
        </div>
        {# FILTROS (Parte interactuable) #}
        <div class="modal fade" id="modalSolicitudesFiltro" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title fw-bold">Filtrar Solicitudes</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="{{ path('app_admin_solicitudes') }}" method="get">
                            
                            <div class="mb-3">
                                <label class="form-label fw-bold">Especie</label>
                                <select class="form-select" name="especie">
                                    <option value="">Todas</option>
                                    <option value="Perro" {{ filtros.especie == 'Perro' ? 'selected' : '' }}>Perro</option>
                                    <option value="Gato" {{ filtros.especie == 'Gato' ? 'selected' : '' }}>Gato</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Tamaño</label>
                                <select class="form-select" name="tamano">
                                    <option value="">Todos</option>
                                    <option value="Pequeño" {{ filtros.tamano == 'Pequeño' ? 'selected' : '' }}>Pequeño</option>
                                    <option value="Mediano" {{ filtros.tamano == 'Mediano' ? 'selected' : '' }}>Mediano</option>
                                    <option value="Grande" {{ filtros.tamano == 'Grande' ? 'selected' : '' }}>Grande</option>
                                </select>
                            </div>

                            <div class="d-grid gap-2 mt-4">
                                <button type="submit" class="btn text-white" style="background-color: #0F5D3C;">Aplicar Filtrar</button>
                                <a href="{{ path('app_admin_solicitudes') }}" class="btn btn-outline-secondary">Limpiar Filtros</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}