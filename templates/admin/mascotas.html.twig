{% extends 'base.html.twig' %}

{% block title %}Gestionar Mascotas{% endblock %}

{% block body %}
    
    {# FONDO MARRÓN EXTERNO #}
    <div style="background-color: #846355; min-height: 85vh; padding: 40px 0;">
        <div class="container">
            
            {# CONTENEDOR BLANCO CENTRAL #}
            <div class="bg-white shadow-lg" style="border-radius: 12px; padding: 40px; min-height: 80vh;">
                
                {# TÍTULO #}
                <h2 class="text-center mb-5" style="color: #000; font-weight: bold; font-size: 1.8rem;">Gestionar Mascotas</h2>

                {# BARRA DE HERRAMIENTAS #}
                    <div class="d-flex justify-content-center align-items-center mb-5 flex-wrap gap-4">                    
                    {# 1. Botón Filtros (Verde oscuro) #}
                    <button class="btn text-white px-4" 
                            style="background-color: #0F5D3C; border-radius: 5px;"
                            data-bs-toggle="modal" 
                            data-bs-target="#modalAdminFiltros">
                        Filtros
                    </button>

                    {# Dropdown Ordenar Admin #}
                    <select class="form-select w-auto text-center" 
                            style="border-radius: 5px; border-color: #ccc; min-width: 200px;"
                            onchange="actualizarOrdenAdmin(this.value)">
                        <option selected>Ordenar por...</option>
                        <option value="reciente" {{ filtros.orden == 'reciente' ? 'selected' : '' }}>Más recientes</option>
                        <option value="antigua" {{ filtros.orden == 'antigua' ? 'selected' : '' }}>Más antiguas</option>
                        <option value="mas_solicitudes" {{ filtros.orden == 'mas_solicitudes' ? 'selected' : '' }}>Más solicitudes</option>
                        <option value="menos_solicitudes" {{ filtros.orden == 'menos_solicitudes' ? 'selected' : '' }}>Menos solicitudes</option>
                    </select>

                    {# SCRIPT #}
                    <script>
                        function actualizarOrdenAdmin(valor) {
                            const url = new URL(window.location.href);
                            url.searchParams.set('orden', valor);
                            window.location.href = url.toString();
                        }
                    </script>

                    {# 3. Botón Añadir (Verde oscuro) - Lo conectaremos luego #}
                    <a href="{{ path('app_admin_mascota_agregar') }}" class="btn text-white px-4" style="background-color: #0F5D3C; border-radius: 5px;">
                        Añadir Mascotas
                    </a>
                </div>

                {# GRILLA DE TARJETAS #}
                <div class="row g-4">
                    {% for mascota in mascotas %}
                        {# Usamos col-lg-3 para que entren 4 por fila, igual a la imagen #}
                        <div class="col-md-6 col-lg-3">
                            
                            <div class="card h-100 shadow-sm text-center p-3" style="border-radius: 15px; border: 2px solid #e0e0e0;">
                                
                                {# Imagen #}
                                <div style="aspect-ratio: 1/1; overflow: hidden; border-radius: 10px; margin-bottom: 15px;">
                                    <img src="{{ asset('uploads/mascotas/' ~ mascota.imagen) }}" 
                                        alt="{{ mascota.nombre }}" 
                                        style="width: 100%; height: 100%; object-fit: cover;">
                                </div>

                                {# Nombre #}
                                <h5 class="fw-bold mb-2" style="color: #000;">{{ mascota.nombre }}</h5>

                                {# Contador de Solicitudes #}
                                <p class="text-muted small mb-3" style="font-size: 0.85rem;">
                                    {{ mascota.solicitudes|length }} de Solicitudes
                                </p>

                                {# Botones de Acción #}
                                <div class="d-flex justify-content-center gap-2">
                                    
                                    {# Botón Modificar (Sólido) #}
                                    <a href="{{ path('app_admin_mascota_editar', {id: mascota.id}) }}" class="btn btn-sm text-white px-3" style="background-color: #0F5D3C; border-radius: 5px;">
                                        Modificar
                                    </a>

                                    {# Botón Eliminar (Borde) #}
                                    <a href="{{ path('app_admin_mascota_eliminar', {id: mascota.id}) }}" class="btn btn-sm px-3" style="background-color: white; border: 1px solid #0F5D3C; color: #0F5D3C; border-radius: 5px;" onclick="return confirm('¿Estás seguro de eliminar a {{ mascota.nombre }}? Esta acción no se puede deshacer.');">
                                        Eliminar
                                    </a>

                                </div>
                            </div>

                        </div>
                    {% else %}
                        <div class="col-12 text-center py-5">
                            <p class="text-muted">No hay mascotas registradas aún.</p>
                        </div>
                    {% endfor %}
                </div>

                {# --- PAGINACIÓN --- #}
                <div class="d-flex justify-content-center mt-5">
                    {{ knp_pagination_render(mascotas) }}
                </div>

            </div>
        </div>
        <div class="modal fade" id="modalAdminFiltros" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">Filtrar Inventario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{{ path('app_admin_mascotas') }}" method="get">
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Especie</label>
                        <select class="form-select" name="especie">
                            <option value="">Todas</option>
                            <option value="Perro" {{ filtros.especie == 'Perro' ? 'selected' : '' }}>Perro</option>
                            <option value="Gato" {{ filtros.especie == 'Gato' ? 'selected' : '' }}>Gato</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Estado</label>
                        <select class="form-select" name="estado">
                            <option value="">Todos</option>
                            <option value="1" {{ filtros.estado == '1' ? 'selected' : '' }}>Disponible</option>
                            <option value="0" {{ filtros.estado == '0' ? 'selected' : '' }}>No disponible</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Tamaño</label>
                        <select class="form-select" name="tamano">
                            <option value="">Todos</option>
                            <option value="Pequeño" {{ filtros.tamano == 'Pequeño' ? 'selected' : '' }}>Pequeño</option>
                            <option value="Mediano" {{ filtros.tamano == 'Mediano' ? 'selected' : '' }}>Mediano</option>
                            <option value="Grande" {{ filtros.tamano == 'Grande' ? 'selected' : '' }}>Grande</option>
                        </select>
                    </div>

                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn text-white" style="background-color: #0F5D3C;">Aplicar Filtrar</button>
                        <a href="{{ path('app_admin_mascotas') }}" class="btn btn-outline-secondary">Limpiar Filtros</a>
                    </div>
                </form>
            </div>
            </div>
        </div>
        </div>
    </div>

{% endblock %}