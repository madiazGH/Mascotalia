{% extends 'base.html.twig' %}

{% block title %}Mis Solicitudes - Mascotalia{% endblock %}

{% block body %}

    {# --- FONDO MARRÓN EXTERNO --- #}
    <div style="background-color: #846355; min-height: 85vh; padding: 40px 0;">
        <div class="container">
            
            {# --- CONTENEDOR BLANCO CENTRAL --- #}
            <div class="bg-white shadow-lg" style="border-radius: 0px; padding: 40px; min-height: 80vh;">
                {# Nota: En tu imagen el contenedor blanco parece llegar hasta los bordes laterales del container marrón o tener borde recto #}
                
                {# Título #}
                <h2 class="text-center mb-5" style="color: #000; font-weight: bold; font-size: 1.6rem;">Revisá tus solicitudes...</h2>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        
                        {# Bucle de Solicitudes #}
                        {% for solicitud in solicitudes %}
                            
                            {# TARJETA HORIZONTAL #}
                            <div class="card mb-4 shadow-sm" style="border-radius: 15px; border: 2px solid #e0e0e0; overflow: hidden;">
                                <div class="row g-0 align-items-center">
                                    
                                    {# Columna Foto #}
                                    <div class="col-md-4 p-3">
                                        <div style="aspect-ratio: 1/1; overflow: hidden; border-radius: 12px;">
                                            {# OJO: Accedemos a solicitud.mascota.imagen #}
                                            {# Si usas URLs de internet en fixtures, quita la función asset() #}
                                            <img src="{{ solicitud.mascota.imagen }}" 
                                                class="img-fluid rounded-start" 
                                                alt="{{ solicitud.mascota.nombre }}" 
                                                style="width: 100%; height: 100%; object-fit: cover;">
                                        </div>
                                    </div>
                                    
                                    {# Columna Datos #}
                                    <div class="col-md-8">
                                        <div class="card-body">
                                            
                                            {# Nombre Mascota (solicitud.mascota.nombre) #}
                                            <h3 class="card-title mb-2" style="font-weight: bold; font-size: 1.8rem; color: #000;">
                                                {{ solicitud.mascota.nombre }}
                                            </h3>
                                            
                                            {# Fecha (solicitud.fechaEnvio con filtro date) #}
                                            <p class="card-text mb-2" style="font-size: 0.85rem; color: #333;">
                                                Fecha de envio de solicitud - {{ solicitud.fechaEnvio|date('d / m / Y') }}
                                            </p>
                                            
                                            {# Estado (solicitud.estado) #}
                                            <p class="card-text mb-3" style="font-weight: bold; font-size: 1rem; color: #000;">
                                                {{ solicitud.estado }}
                                            </p>

                                            
                                            {% if solicitud.estado == 'Pendiente' %}
                                                
                                                {# Caso 1: Se puede cancelar #}
                                                {# Usamos un formulario pequeño para que sea seguro o un enlace simple si prefieres #}
                                                {# Aquí uso enlace directo por simplicidad, pero con confirmación #}
                                                <a href="{{ path('app_solicitud_cancelar', {id: solicitud.id}) }}" 
                                                    class="btn btn-sm px-3" 
                                                    style="background-color: #C6B6A8; color: #333; font-weight: 500; border-radius: 5px; text-decoration: none;"
                                                    onclick="return confirm('¿Estás seguro de que querés cancelar esta solicitud?');">
                                                    Cancelar
                                                </a>

                                            {% else %}
                                                
                                                {# Caso 2: Ya no se puede cancelar (En Revisión, Aceptada, etc) #}
                                                <button class="btn btn-sm px-3" disabled 
                                                        style="background-color: #e9ecef; color: #999; border: 1px solid #ddd; font-weight: 500; border-radius: 5px; cursor: not-allowed;">
                                                    No cancelable
                                                </button>

                                            {% endif %}

                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        {% else %}
                            {# Mensaje si no tiene solicitudes #}
                            <div class="text-center py-5">
                                <h4 class="text-muted">Aún no has enviado ninguna solicitud.</h4>
                                <a href="{{ path('app_mascotas') }}" class="btn mt-3 text-white" style="background-color: #0F5D3C;">Ver Mascotas</a>
                            </div>
                        {% endfor %}

                    </div>
                </div>

            </div>
            {# Fin Contenedor Blanco #}

        </div>
    </div>

{% endblock %}